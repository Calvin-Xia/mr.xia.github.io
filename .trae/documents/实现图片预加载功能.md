# 实现折叠状态下的图片预加载功能

## 需求分析

1. **预加载时机**：在折叠状态下提前加载图片
2. **性能优化**：不影响初始加载速度
3. **网络适应性**：避免不必要的带宽消耗
4. **即时显示**：展开时图片已加载完成

## 实施方案

### 1. 图片预加载策略

**generateCollapsedPreview()增强**：
- 解析折叠预览内容时，同时提取所有图片URL
- 创建图片预加载队列
- 使用渐进式加载（优先加载首图，然后是其他图片）

**预加载实现**：
```javascript
preloadImages() {
    const imageUrls = this.fullContent.match(/src=["']([^"']+)["']/g) || 
                       this.fullContent.match(/src=\["']([^"']+)["']/g) || [];
    
    imageUrls.forEach(url => {
        const img = new Image();
        img.src = url;
        img.loading = 'eager';
    });
}
```

### 2. 性能优化措施

**懒加载优化**：
- 使用Intersection Observer检测图片是否进入视口
- 只预加载首图和前3张图片
- 其他图片在滚动到可视区域时再加载

**带宽优化**：
- 检测网络连接速度（navigator.connection）
- 慢速网络只预加载首图
- 快速网络预加载所有图片

### 3. 加载状态提示

**添加加载指示器**：
```html
<div id="loading-indicator" class="loading-indicator">
    <span class="loading-spinner"></span>
    <span class="loading-text">正在预加载图片...</span>
</div>
```

**CSS样式**：
```css
.loading-indicator {
    display: none;
    position: fixed;
    bottom: 20px;
    right: 20px;
    padding: 10px 20px;
    background: var(--primary-color);
    color: white;
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-lg);
    z-index: 1000;
}

.loading-indicator.active {
    display: flex;
    align-items: center;
    gap: 10px;
}
```

### 4. 实现步骤

1. 在init()中调用preloadImages()
2. 在showCollapsed()中显示加载指示器
3. 在showExpanded()中隐藏加载指示器
4. 添加网络连接检测逻辑
5. 实现图片加载完成回调

### 5. 预期效果

✅ 折叠状态时后台预加载图片
✅ 展开时图片立即显示，无延迟
✅ 不影响页面初始加载速度
✅ 根据网络速度智能调整预加载策略
✅ 显示加载状态提示