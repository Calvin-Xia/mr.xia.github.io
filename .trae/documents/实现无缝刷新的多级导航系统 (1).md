# 实现无缝刷新的多级导航系统

## 需求分析

用户需要完整的导航管理系统，支持：
1. 页面间无缝跳转（无刷新）
2. 保存和恢复页面状态（滚动位置、表单输入）
3. 支持浏览器后退/前进按钮
4. 支持works.html、timetable.html、statement.html和about.html之间的导航

## 实施步骤

### 1. 创建NavigationManager模块

在js/main.js中创建完整的导航管理器：

```javascript
const NavigationManager = {
    pages: {
        'works': 'Works.html',
        'timetable': 'timetable.html',
        'statement': 'statement.html',
        'about': 'about.html',
        'home': 'index.html'
    },
    
    init() {
        window.addEventListener('popstate', (event) => {
            this.handleNavigation(event.state);
        });
        
        window.addEventListener('hashchange', () => {
            this.handleHashNavigation();
        });
    },
    
    handleNavigation(state) {
        if (state && state.page) {
            this.navigateTo(state.page, false);
        }
    },
    
    handleHashNavigation() {
        const hash = window.location.hash.slice(1);
        if (hash) {
            const page = this.pages[hash];
            if (page) {
                this.navigateTo(page, false);
            }
        }
    },
    
    navigateTo(page, saveState = true) {
        if (saveState) {
            this.saveCurrentPageState();
        }
        
        history.pushState({ page: page }, '', `#${this.getPageHash(page)}`);
    },
    
    saveCurrentPageState() {
        const state = {
            page: this.getCurrentPage(),
            scrollPosition: window.scrollY,
            formInputs: this.getFormInputs(),
            timestamp: Date.now()
        };
        sessionStorage.setItem('pageState', JSON.stringify(state));
    },
    
    getCurrentPage() {
        const path = window.location.pathname;
        for (const [name, url] of Object.entries(this.pages)) {
            if (path.endsWith(url)) {
                return name;
            }
        }
        return 'home';
    },
    
    getPageHash(page) {
        const hashMap = {
            'works': 'works',
            'timetable': 'tools',
            'statement': 'articles',
            'about': 'about'
        };
        return hashMap[page] || page;
    },
    
    getFormInputs() {
        const inputs = {};
        document.querySelectorAll('input, select, textarea').forEach(input => {
            inputs[input.id] = input.value;
        });
        return inputs;
    },
    
    restorePageState() {
        const savedState = sessionStorage.getItem('pageState');
        if (savedState) {
            try {
                const state = JSON.parse(savedState);
                if (state.scrollPosition) {
                    window.scrollTo(0, state.scrollPosition);
                }
                if (state.formInputs) {
                    this.restoreFormInputs(state.formInputs);
                }
            } catch (e) {
                console.warn('Failed to restore page state:', e);
            }
        }
    },
    
    restoreFormInputs(inputs) {
        Object.entries(inputs).forEach(([id, value]) => {
            const element = document.getElementById(id);
            if (element) {
                element.value = value;
            }
        });
    }
};
```

### 2. 更新各HTML页面

为每个页面添加"返回首页"按钮（禁用状态）：

#### index.html
- 添加"返回首页"按钮（disabled）
- 添加其他页面的导航链接

#### Works.html
- 添加"返回首页"按钮（disabled）
- 添加其他页面的导航链接

#### timetable.html
- 添加"返回首页"按钮（disabled）
- 添加其他页面的导航链接

#### statement.html
- 添加"返回首页"按钮（disabled）
- 添加其他页面的导航链接

#### about.html
- 添加"返回首页"按钮（disabled）
- 添加其他页面的导航链接

### 3. 初始化NavigationManager

在DOMContentLoaded事件中调用NavigationManager.init()

### 4. 边界情况处理

- 直接URL访问
- 浏览器后退/前进按钮
- 页面刷新
- 表单输入状态恢复
- 意外的hash变化

### 5. 测试验证

在以下浏览器中测试：

- Chrome/Edge
- Firefox
- Safari
- 移动端浏览器

## 预期效果

✅ 无刷新导航，用户体验流畅
✅ 浏览器后退/前进按钮正常工作
✅ 页面状态自动保存和恢复
✅ 表单输入状态保留
✅ 跨页面无缝跳转
✅ 边界情况正确处理