# 工具功能开发

## 在线计时器

### 问题分析

#### 计时精度问题
- 使用setInterval(() => this.update(), 1000)不能保证精确的1秒间隔
- 简单计数器递增方式可能导致时间偏差
- 页面有其他任务运行时影响计时准确性

#### 按钮状态同步问题
- 切换选项卡时，计时器状态可能不会正确保存
- 页面加载时，初始状态可能不正确

#### 逻辑一致性问题
- reset()方法直接设置显示为'00:00:00'，未使用格式化函数
- 缺少统一的时间格式化函数

#### 长时间计时问题
- setInterval的累积误差导致长时间计时显示不准确

### 修复方案

#### 基于时间戳的计时方式
- 记录计时器开始的时间戳
- 记录已经经过的时间
- 计算当前时间与开始时间的差值，加上已过时间
- 避免累积误差

#### 统一时间格式化函数
```javascript
formatTime(seconds) {
    const hours = Math.floor(seconds / 3600);
    const minutes = Math.floor((seconds % 3600) / 60);
    const secs = seconds % 60;
    return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
}
```

#### 按钮状态管理
- 确保选项卡切换时状态正确同步
- 页面加载时初始状态正确设置
- 运行时：开始按钮禁用，暂停按钮启用
- 暂停时：开始按钮启用，暂停按钮禁用

#### Timer对象结构
```javascript
const Timer = {
    startTime: null,      // 计时器开始时间戳
    elapsedTime: 0,       // 已经经过的时间（毫秒）
    intervalId: null,
    isRunning: false,
    // ... 其他属性和方法
};
```

### 具体实现

#### update方法
- 计算总经过时间
- 转换为小时、分钟、秒
- 更新显示
- 提高更新频率至100ms，使显示更流畅

#### start方法
- 记录开始时间戳
- 设置运行状态为true
- 启动定时器
- 更新按钮状态

#### pause方法
- 清除定时器
- 累加已过时间
- 重置开始时间戳
- 设置运行状态为false
- 更新按钮状态

#### reset方法
- 调用pause()停止计时
- 重置已过时间为0
- 使用formatTime(0)更新显示
- 重置按钮状态

#### 选项卡切换状态同步
- 确保计时器元素ID不冲突
- 同步计时器显示和按钮状态
- 保持计时器运行状态

### 测试方案

#### 计时精度测试
- 运行5分钟，与实际时间比较
- 确认计时准确

#### 频繁操作测试
- 频繁点击开始、暂停、重置按钮
- 确认状态正确，显示准确

#### 长时间计时测试
- 运行1小时，确认无累积误差

#### 选项卡切换测试
- 启动计时器，切换选项卡，再切回
- 确认状态正确保存

#### 页面刷新测试
- 启动计时器，刷新页面
- 确认状态正确重置

#### 多场景组合测试
- 长时间计时 + 频繁操作 + 选项卡切换
- 确认所有功能正常

## 随机选择器

### 选项卡组件实现

#### 修改timetable.html结构
- 添加选项卡导航栏（计时器、随机选择器）
- 创建两个选项卡内容区域
- 保持现有计时器功能不变

#### 选项卡切换功能
- 监听选项卡点击事件
- 切换选项卡激活状态
- 显示/隐藏对应内容区域
- 添加视觉反馈

#### CSS样式
- 选项卡导航栏样式
- 激活状态样式
- 内容区域样式
- 响应式设计

### 随机选择器功能集成

#### HTML结构迁移
从choice_choicebycopilot.html迁移：
- 输入框和添加按钮
- 选项列表
- 随机抽取按钮
- 抽中结果显示区域
- 文件上传功能

#### JavaScript逻辑迁移
- 选项管理（添加、删除、清空）
- 随机抽取功能
- 文件上传和处理功能
- 外部库引用（docx.min.js、mammoth.browser.min.js）

#### 样式调整
- 使用现有CSS变量
- 调整容器大小和布局
- 统一按钮样式
- 确保响应式设计

### 测试功能

#### 选项卡切换测试
- 点击选项卡，确认内容正确切换
- 确认激活状态有明显视觉反馈

#### 计时器功能测试
- 确认开始、暂停、重置功能正常
- 确认显示正确

#### 随机选择器功能测试
- 确认添加、删除、清空功能正常
- 确认随机抽取功能正常
- 确认文件上传和自动填充功能正常

#### 响应式设计测试
- 确认不同屏幕尺寸下功能正常

### 优化和调整

#### 代码结构优化
- 整理JavaScript代码
- 移除冗余代码
- 符合最佳实践

#### 用户体验优化
- 添加适当的提示信息
- 优化交互反馈
- 确保界面美观易用

#### 兼容性确保
- 确保所有主流浏览器正常工作
- 确保外部库引用正确

## 预期效果

### 计时器
- 计时精确，无累积误差
- 按钮状态正确同步
- 长时间计时准确
- 选项卡切换状态保持
- 界面显示准确且响应及时

### 随机选择器
- 选项卡切换流畅
- 所有功能正常工作
- 样式统一协调
- 响应式设计良好
- 用户体验优秀