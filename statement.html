<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Mr.Xiaä¸ªäººç½‘ç«™å£°æ˜">
    <title>ç½‘ç«™å£°æ˜ - Mr.Xia</title>
    <link rel="stylesheet" href="css/style.css">
    <!-- å¼•å…¥Markdownæ¸²æŸ“ç›¸å…³åº“ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/11.1.1/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/contrib/auto-render.min.js"></script>
</head>
<body>
    <!-- åŠ¨æ€èƒŒæ™¯ -->
    <div class="bg-img"></div>

    <!-- é¡µçœ‰å¯¼èˆª -->
    <header>
        <nav>
            <div class="logo">Mr.Xia</div>
            <ul class="nav-links">
                <li><a href="index.html">é¦–é¡µ</a></li>
                <li><a href="Works.html">ä½œå“</a></li>
                <li><a href="timetable.html">å·¥å…·</a></li>
                <li><a href="statement.html">å£°æ˜</a></li>
            </ul>
        </nav>
    </header>

    <!-- ä¸»å†…å®¹ -->
    <main>
        <section>
            <h1>ç½‘ç«™å£°æ˜ ğŸ“‹</h1>
            <p class="text-small" style="margin-bottom: var(--spacing-lg);">
                æœ€åæ›´æ–°æ—¶é—´ï¼š2025å¹´12æœˆ31æ—¥
            </p>
        </section>

        <!-- Markdownå±•ç¤ºæ¡† -->
        <div class="shadowbox markdown-container">
            <h2 style="text-align: center; margin-bottom: var(--spacing-lg);">
                ğŸ“ 2025å¹´åº¦æ€»ç»“
            </h2>

            <!-- æ¸²æŸ“ç»“æœ -->
            <div id="markdown-output" class="markdown-content">
                <p style="text-align: center; color: var(--text-secondary);">åŠ è½½ä¸­...</p>
            </div>
        </div>


        <!-- å£°æ˜å†…å®¹ -->
        <div class="shadowbox">
            <h2 style="text-align: center; margin-bottom: var(--spacing-lg);">
                å…³äºæœ¬ç«™
            </h2>
            
            <div style="margin-top: var(--spacing-lg);">
                <h3 style="color: var(--primary-color); margin-bottom: var(--spacing-sm);">
                    ğŸ“Œ ç‰ˆæƒå£°æ˜
                </h3>
                <p class="indent">
                    æœ¬ç½‘ç«™æ‰€æœ‰åŸåˆ›å†…å®¹ç‰ˆæƒå½’ Mr.Xia æ‰€æœ‰ã€‚æœªç»è®¸å¯ï¼Œè¯·å‹¿è½¬è½½æˆ–å•†ä¸šä½¿ç”¨ã€‚
                </p>
            </div>

            <div style="margin-top: var(--spacing-lg);">
                <h3 style="color: var(--primary-color); margin-bottom: var(--spacing-sm);">
                    ğŸ”’ éšç§æ”¿ç­–
                </h3>
                <p class="indent">
                    æœ¬ç«™å°Šé‡å¹¶ä¿æŠ¤æ‰€æœ‰è®¿é—®è€…çš„éšç§ã€‚æˆ‘ä»¬ä¸ä¼šæ”¶é›†æ‚¨çš„ä¸ªäººä¿¡æ¯ï¼Œä¹Ÿä¸ä¼šä½¿ç”¨ Cookie è¿½è¸ªæ‚¨çš„è¡Œä¸ºã€‚
                </p>
            </div>

            <div style="margin-top: var(--spacing-lg);">
                <h3 style="color: var(--primary-color); margin-bottom: var(--spacing-sm);">
                    âš ï¸ å…è´£å£°æ˜
                </h3>
                <p class="indent">
                    æœ¬ç«™å†…å®¹ä»…ä¾›å­¦ä¹ äº¤æµä½¿ç”¨ï¼Œä¸æ„æˆä»»ä½•ä¸“ä¸šå»ºè®®ã€‚è®¿é—®è€…ä½¿ç”¨æœ¬ç«™å†…å®¹äº§ç”Ÿçš„ä»»ä½•åæœï¼Œæœ¬ç«™ä¸æ‰¿æ‹…è´£ä»»ã€‚
                </p>
            </div>

            <div style="margin-top: var(--spacing-lg);">
                <h3 style="color: var(--primary-color); margin-bottom: var(--spacing-sm);">
                    ğŸ“§ è”ç³»æ–¹å¼
                </h3>
                <p class="indent">
                    å¦‚æœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š
                </p>
                <p class="indent">
                    é‚®ç®±ï¼š<a href="mailto:xiaziyuan913@outlook.com">ç‚¹å‡»è¿™é‡Œ</a>æ¥è”ç³»æˆ‘
                </p>
            </div>
        </div>

        <!-- è¿”å›é¦–é¡µ -->
        <div style="text-align: center; margin-top: var(--spacing-xl);">
            <a href="index.html" class="btn btn-secondary">
                â† è¿”å›é¦–é¡µ
            </a>
        </div>
    </main>

    <!-- JavaScript -->
    <script src="js/main.js"></script>
    <script>
        // Markdowné™æ€æ¸²æŸ“åŠŸèƒ½
        const MarkdownRenderer = {
            init() {
                this.outputElement = document.getElementById('markdown-output');

                if (!this.outputElement) {
                    console.error('Markdown output element not found');
                    return;
                }

                console.log('MarkdownRenderer initialized');

                // é…ç½®markedé€‰é¡¹
                marked.setOptions({
                    breaks: true,
                    gfm: true
                });

                // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ¸²æŸ“æŒ‡å®šè·¯å¾„çš„markdownæ–‡ä»¶
                this.loadAndRender('storage/2025å¹´åº¦æ€»ç»“/2025å¹´åº¦æ€»ç»“.md');
            },

            async loadAndRender(filePath) {
                console.log('Loading markdown file:', filePath);
                try {
                    const response = await fetch(filePath);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const markdownText = await response.text();
                    console.log('Markdown file loaded, length:', markdownText.length);
                    this.render(markdownText);
                } catch (err) {
                    console.error('Markdown file load error:', err);
                    this.outputElement.innerHTML = '<p style="color: var(--error-color); text-align: center;">æ–‡ä»¶åŠ è½½å¤±è´¥ï¼Œè¯·ç¡®ä¿markdownæ–‡ä»¶å­˜åœ¨</p>';
                }
            },

            render(markdownText) {
                console.log('Rendering markdown...');
                const html = marked.parse(markdownText);
                this.outputElement.innerHTML = html;
                console.log('Markdown rendered, HTML length:', html.length);

                // æ¸²æŸ“æ•°å­¦å…¬å¼
                this.renderMath();

                // é«˜äº®ä»£ç å—
                this.highlightCode();

                // å¤„ç†å›¾ç‰‡ï¼Œæ·»åŠ å¤‡æ³¨æ–‡æœ¬
                this.processImages();

                console.log('Markdown rendering complete');
            },

            renderMath() {
                try {
                    renderMathInElement(this.outputElement, {
                        delimiters: [
                            {left: '$$', right: '$$', display: true},
                            {left: '$', right: '$', display: false}
                        ],
                        throwOnError: false
                    });
                } catch (err) {
                    console.warn('Math rendering error:', err);
                }
            },

            highlightCode() {
                try {
                    this.outputElement.querySelectorAll('pre code').forEach((block) => {
                        hljs.highlightElement(block);
                    });
                } catch (err) {
                    console.warn('Code highlighting error:', err);
                }
            },

            processImages() {
                const flexWrappers = this.outputElement.querySelectorAll('div[style*="flex"]');
                
                flexWrappers.forEach(wrapper => {
                    const flexImages = wrapper.querySelectorAll('img');
                    
                    flexImages.forEach(img => {
                        const altText = img.getAttribute('alt');
                        if (altText) {
                            const originalStyle = img.getAttribute('style') || '';
                            const widthMatch = originalStyle.match(/width:\s*([\d.]+)%/);
                            const widthPercent = widthMatch ? widthMatch[1] + '%' : 'auto';
                            
                            const wrapperDiv = document.createElement('div');
                            wrapperDiv.style.cssText = `display: flex; flex-direction: column; align-items: center; width: ${widthPercent}; box-sizing: border-box;`;
                            
                            img.parentNode.insertBefore(wrapperDiv, img);
                            wrapperDiv.appendChild(img);
                            
                            const imgStyle = originalStyle.replace(/width:\s*[\d.]+%[^;]*;?\s*/g, '').trim();
                            if (imgStyle) {
                                img.setAttribute('style', imgStyle);
                            } else {
                                img.removeAttribute('style');
                            }
                            
                            const caption = document.createElement('div');
                            caption.className = 'image-caption';
                            caption.textContent = altText;
                            caption.style.marginTop = '4px';
                            caption.style.marginBottom = '0';
                            wrapperDiv.appendChild(caption);
                        }
                    });
                });
                
                const standaloneImages = this.outputElement.querySelectorAll('img');
                standaloneImages.forEach(img => {
                    if (!img.closest('[style*="flex"]')) {
                        const altText = img.getAttribute('alt');
                        if (altText && !img.nextElementSibling?.classList.contains('image-caption')) {
                            const caption = document.createElement('div');
                            caption.className = 'image-caption';
                            caption.textContent = altText;
                            caption.style.marginTop = '4px';
                            caption.style.marginBottom = '16px';
                            
                            if (img.parentNode) {
                                img.parentNode.insertBefore(caption, img.nextSibling);
                            }
                        }
                    }
                });
            }
        };

        // ä½¿ç”¨window.onloadç¡®ä¿æ‰€æœ‰èµ„æºåŠ è½½å®Œæˆåå†æ¸²æŸ“
        window.addEventListener('load', () => {
            console.log('Window loaded, initializing MarkdownRenderer');
            MarkdownRenderer.init();
        });
    </script>
</body>
</html>