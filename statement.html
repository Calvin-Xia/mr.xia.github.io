<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Mr.Xiaä¸ªäººç½‘ç«™æ–‡ç« ">
    <title>æ–‡ç«  - Mr.Xia</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        #blog-container {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-lg);
            margin-top: var(--spacing-lg);
        }

        .loading-indicator {
            text-align: center;
            color: var(--text-secondary);
            padding: var(--spacing-xl);
        }

        .blog-card {
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .blog-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 12px -1px rgba(0, 0, 0, 0.15);
        }

        .blog-card-link {
            display: block;
            padding: var(--spacing-lg);
            text-decoration: none;
            color: inherit;
        }

        .blog-card-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin: 0 0 var(--spacing-sm);
            color: var(--text-primary);
            transition: color 0.2s ease;
        }

        .blog-card:hover .blog-card-title {
            color: var(--primary-color);
        }

        .blog-card-excerpt {
            margin: 0;
            color: var(--text-secondary);
            line-height: 1.6;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .blog-card-date {
            padding: 0 var(--spacing-lg) var(--spacing-md);
            font-size: 0.875rem;
            color: var(--text-secondary);
            opacity: 0.8;
        }

        .blog-card-meta {
            padding: 0 var(--spacing-lg) var(--spacing-md);
            display: flex;
            gap: var(--spacing-sm);
            flex-wrap: wrap;
        }

        .blog-card-tag {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            background: rgba(99, 102, 241, 0.1);
            color: var(--primary-color);
            border-radius: var(--radius-sm);
            font-size: 0.8125rem;
            font-weight: 500;
        }

        .blog-card-category {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            background: rgba(236, 72, 153, 0.1);
            color: var(--secondary-color);
            border-radius: var(--radius-sm);
            font-size: 0.8125rem;
            font-weight: 500;
        }

        .search-container {
            position: relative;
            margin-bottom: var(--spacing-lg);
        }

        .search-box {
            display: flex;
            align-items: center;
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            padding: var(--spacing-sm);
            border: 2px solid transparent;
            transition: all var(--transition-base);
        }

        .search-box:focus-within {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        #search-input {
            flex: 1;
            border: none;
            outline: none;
            padding: var(--spacing-sm);
            font-size: 1rem;
            background: transparent;
        }

        #search-input::placeholder {
            color: var(--text-light);
        }

        .search-btn {
            background: var(--primary-color);
            border: none;
            border-radius: var(--radius-md);
            padding: var(--spacing-sm);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast);
        }

        .search-btn:hover {
            background: var(--primary-dark);
        }

        .search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            margin-top: var(--spacing-xs);
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .search-suggestions.active {
            display: block;
        }

        .suggestion-item {
            padding: var(--spacing-sm) var(--spacing-md);
            cursor: pointer;
            transition: background var(--transition-fast);
            border-bottom: 1px solid var(--border-color);
        }

        .suggestion-item:last-child {
            border-bottom: none;
        }

        .suggestion-item:hover {
            background: var(--hover-color);
        }

        .suggestion-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .suggestion-meta {
            font-size: 0.875rem;
            color: var(--text-light);
        }

        .filter-nav {
            background: white;
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
            box-shadow: var(--shadow-md);
        }

        .filter-section {
            margin-bottom: var(--spacing-md);
        }

        .filter-section:last-child {
            margin-bottom: 0;
        }

        .filter-section h3 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--spacing-sm);
        }

        .filter-tags {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-xs);
        }

        .filter-tag {
            padding: 0.5rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            background: white;
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .filter-tag:hover {
            background: var(--hover-color);
            color: var(--text-primary);
        }

        .filter-tag.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .no-results {
            text-align: center;
            padding: var(--spacing-xl);
            color: var(--text-secondary);
        }

        .no-results-icon {
            font-size: 3rem;
            margin-bottom: var(--spacing-md);
        }

        @media (max-width: 768px) {
            .blog-card-title {
                font-size: 1.25rem;
            }

            .blog-card-link {
                padding: var(--spacing-md);
            }

            .blog-card-date {
                padding: 0 var(--spacing-md) var(--spacing-md);
                font-size: 0.8125rem;
            }

            .filter-nav {
                padding: var(--spacing-md);
            }

            .filter-tag {
                padding: 0.375rem 0.75rem;
                font-size: 0.8125rem;
            }
        }
    </style>
</head>
<body>
    <!-- åŠ¨æ€èƒŒæ™¯ -->
    <div class="bg-img"></div>

    <!-- é¡µçœ‰å¯¼èˆª -->
    <header>
        <nav>
            <div class="logo">Mr.Xia</div>
            <ul class="nav-links">
                <li><a href="index.html" data-history="true" data-title="é¦–é¡µ">é¦–é¡µ</a></li>
                <li><a href="Works.html" data-history="true" data-title="ä½œå“">ä½œå“</a></li>
                <li><a href="timetable.html" data-history="true" data-title="å·¥å…·">å·¥å…·</a></li>
                <li><a href="statement.html" data-history="true" data-title="æ–‡ç« ">æ–‡ç« </a></li>
                <li><a href="about.html" data-history="true" data-title="å…³äº">å…³äº</a></li>
            </ul>
        </nav>
    </header>

    <!-- ä¸»å†…å®¹ -->
    <main>
        <section>
            <h1>åšå®¢æ–‡ç« </h1>
            <p class="text-small" style="margin-bottom: var(--spacing-lg);">
                è®°å½•ç”Ÿæ´»ï¼Œåˆ†äº«æ€è€ƒ
            </p>
        </section>

        <!-- æœç´¢æ¡† -->
        <div class="search-container">
            <div class="search-box">
                <input 
                    type="text" 
                    id="search-input" 
                    placeholder="æœç´¢æ–‡ç« æ ‡é¢˜ã€å†…å®¹æˆ–æ ‡ç­¾..." 
                    autocomplete="off"
                >
                <button id="search-btn" class="search-btn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="m21 21-4.35-4.35"></path>
                    </svg>
                </button>
            </div>
            <div id="search-suggestions" class="search-suggestions"></div>
        </div>

        <!-- åˆ†ç±»å’Œæ ‡ç­¾å¯¼èˆª -->
        <div class="filter-nav">
            <div class="filter-section">
                <h3>åˆ†ç±»</h3>
                <div id="category-filters" class="filter-tags">
                    <button class="filter-tag active" data-filter="all" data-type="category">å…¨éƒ¨</button>
                </div>
            </div>
            <div class="filter-section">
                <h3>æ ‡ç­¾</h3>
                <div id="tag-filters" class="filter-tags">
                    <button class="filter-tag active" data-filter="all" data-type="tag">å…¨éƒ¨</button>
                </div>
            </div>
        </div>

        <!-- åšå®¢æ–‡ç« åˆ—è¡¨ -->
        <div id="blog-container">
            <div class="loading-indicator">åŠ è½½ä¸­...</div>
        </div>

        <!-- è¿”å›é¦–é¡µ -->
        <div style="text-align: center; margin-top: var(--spacing-xl);">
            <a href="index.html" class="btn btn-secondary" onclick="NavigationController.goHome(); return false;">
                â† è¿”å›é¦–é¡µ
            </a>
        </div>
        
        <!-- é¡µè„š -->
        <div class="footer" style="text-align: right;">
            <p class="footer-text">
                <a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener">æ¸ICPå¤‡2026000319å·</a>
                <br>
                <a href="https://beian.mps.gov.cn/#/query/webSearch?code=50010102001439" rel="noreferrer" target="_blank">
                    <img src="storage\Beian.png" alt="å…¬å®‰å¤‡æ¡ˆ" style="width: 20px; height: 20px; vertical-align: middle; margin-left: 5px;">
                    æ¸å…¬ç½‘å®‰å¤‡50010102001439å·
                </a>
            </p>
        </div>
    </main>

    <!-- JavaScript -->
    <script src="js/main.js"></script>
    <script>
        // æœç´¢æ¨¡å—
        const Search = {
            articles: [],
            searchInput: null,
            searchSuggestions: null,
            searchBtn: null,
            debounceTimer: null,

            init() {
                this.searchInput = document.getElementById('search-input');
                this.searchSuggestions = document.getElementById('search-suggestions');
                this.searchBtn = document.getElementById('search-btn');

                if (!this.searchInput || !this.searchSuggestions || !this.searchBtn) {
                    console.error('Search elements not found');
                    return;
                }

                this.searchInput.addEventListener('input', (e) => this.handleInput(e));
                this.searchBtn.addEventListener('click', () => this.performSearch());
                this.searchInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.performSearch();
                    }
                });

                document.addEventListener('click', (e) => {
                    if (!this.searchInput.contains(e.target) && !this.searchSuggestions.contains(e.target)) {
                        this.hideSuggestions();
                    }
                });
            },

            setArticles(articles) {
                this.articles = articles;
            },

            handleInput(e) {
                clearTimeout(this.debounceTimer);
                const query = e.target.value.trim();

                if (query.length === 0) {
                    this.hideSuggestions();
                    BlogLoader.renderArticles(this.articles, document.getElementById('blog-container'));
                    return;
                }

                this.debounceTimer = setTimeout(() => {
                    this.showSuggestions(query);
                }, 300);
            },

            showSuggestions(query) {
                const suggestions = this.findSuggestions(query);
                
                if (suggestions.length === 0) {
                    this.hideSuggestions();
                    return;
                }

                this.searchSuggestions.innerHTML = suggestions.map(article => `
                    <div class="suggestion-item" data-id="${article.id}">
                        <div class="suggestion-title">${this.highlightMatch(article.title, query)}</div>
                        <div class="suggestion-meta">${article.category} Â· ${article.date}</div>
                    </div>
                `).join('');

                this.searchSuggestions.classList.add('active');

                this.searchSuggestions.querySelectorAll('.suggestion-item').forEach(item => {
                    item.addEventListener('click', () => {
                        const articleId = item.dataset.id;
                        const article = this.articles.find(a => a.id === articleId);
                        if (article) {
                            window.location.href = article.filePath;
                        }
                    });
                });
            },

            hideSuggestions() {
                this.searchSuggestions.classList.remove('active');
            },

            findSuggestions(query) {
                const lowerQuery = query.toLowerCase();
                return this.articles.filter(article => 
                    article.title.toLowerCase().includes(lowerQuery) ||
                    article.tags.some(tag => tag.toLowerCase().includes(lowerQuery))
                ).slice(0, 5);
            },

            highlightMatch(text, query) {
                const regex = new RegExp(`(${query})`, 'gi');
                return text.replace(regex, '<mark style="background: rgba(99, 102, 241, 0.2); padding: 0 2px; border-radius: 2px;">$1</mark>');
            },

            performSearch() {
                const query = this.searchInput.value.trim().toLowerCase();
                this.hideSuggestions();

                if (query.length === 0) {
                    BlogLoader.renderArticles(this.articles, document.getElementById('blog-container'));
                    return;
                }

                const results = this.articles.filter(article => 
                    article.title.toLowerCase().includes(query) ||
                    article.excerpt.toLowerCase().includes(query) ||
                    article.tags.some(tag => tag.toLowerCase().includes(query)) ||
                    article.category.toLowerCase().includes(query)
                );

                BlogLoader.renderArticles(results, document.getElementById('blog-container'));
            }
        };

        // åšå®¢æ–‡ç« åˆ—è¡¨åŠ è½½åŠŸèƒ½
        const BlogLoader = {
            articles: [],
            currentCategory: 'all',
            currentTag: 'all',

            async init() {
                const container = document.getElementById('blog-container');
                if (!container) {
                    console.error('Blog container not found');
                    return;
                }

                try {
                    const articles = await this.loadAllArticles();
                    this.articles = articles;
                    Search.setArticles(articles);
                    this.renderFilters();
                    this.renderArticles(articles, container);
                } catch (err) {
                    console.error('Failed to load blog articles:', err);
                    container.innerHTML = '<p style="color: var(--error-color); text-align: center;">æ–‡ç« åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•</p>';
                }
            },

            async loadAllArticles() {
                const metadata = await this.loadMetadata();
                if (!metadata || metadata.length === 0) {
                    console.warn('No metadata found or failed to load blog-metadata.json');
                    return [];
                }

                return metadata;
            },

            async loadMetadata() {
                try {
                    const response = await fetch('blog/blog-metadata.json');
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const metadata = await response.json();
                    return metadata;
                } catch (err) {
                    console.error('Failed to load blog-metadata.json:', err);
                    return null;
                }
            },

            renderFilters() {
                const categories = new Set(this.articles.map(a => a.category));
                const tags = new Set(this.articles.flatMap(a => a.tags));

                const categoryContainer = document.getElementById('category-filters');
                const tagContainer = document.getElementById('tag-filters');

                if (categoryContainer) {
                    categoryContainer.innerHTML = '<button class="filter-tag active" data-filter="all" data-type="category">å…¨éƒ¨</button>';
                    categories.forEach(category => {
                        const btn = document.createElement('button');
                        btn.className = 'filter-tag';
                        btn.dataset.filter = category;
                        btn.dataset.type = 'category';
                        btn.textContent = category;
                        categoryContainer.appendChild(btn);
                    });

                    categoryContainer.querySelectorAll('.filter-tag').forEach(btn => {
                        btn.addEventListener('click', (e) => this.handleFilterClick(e));
                    });
                }

                if (tagContainer) {
                    tagContainer.innerHTML = '<button class="filter-tag active" data-filter="all" data-type="tag">å…¨éƒ¨</button>';
                    tags.forEach(tag => {
                        const btn = document.createElement('button');
                        btn.className = 'filter-tag';
                        btn.dataset.filter = tag;
                        btn.dataset.type = 'tag';
                        btn.textContent = tag;
                        tagContainer.appendChild(btn);
                    });

                    tagContainer.querySelectorAll('.filter-tag').forEach(btn => {
                        btn.addEventListener('click', (e) => this.handleFilterClick(e));
                    });
                }
            },

            handleFilterClick(e) {
                const filter = e.target.dataset.filter;
                const type = e.target.dataset.type;

                const container = type === 'category' ? document.getElementById('category-filters') : document.getElementById('tag-filters');
                container.querySelectorAll('.filter-tag').forEach(btn => btn.classList.remove('active'));
                e.target.classList.add('active');

                if (type === 'category') {
                    this.currentCategory = filter;
                } else {
                    this.currentTag = filter;
                }

                this.applyFilters();
            },

            applyFilters() {
                let filtered = this.articles;

                if (this.currentCategory !== 'all') {
                    filtered = filtered.filter(a => a.category === this.currentCategory);
                }

                if (this.currentTag !== 'all') {
                    filtered = filtered.filter(a => a.tags.includes(this.currentTag));
                }

                this.renderArticles(filtered, document.getElementById('blog-container'));
            },

            renderArticles(articles, container) {
                if (articles.length === 0) {
                    container.innerHTML = `
                        <div class="no-results">
                            <div class="no-results-icon">ğŸ”</div>
                            <p>æ²¡æœ‰æ‰¾åˆ°ç›¸å…³æ–‡ç« </p>
                            <p class="text-small">è¯•è¯•å…¶ä»–å…³é”®è¯æˆ–ç­›é€‰æ¡ä»¶</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = '';

                articles.forEach(article => {
                    const articleCard = this.createArticleCard(article);
                    container.appendChild(articleCard);
                });
            },

            createArticleCard(article) {
                const card = document.createElement('div');
                card.className = 'blog-card';

                const link = document.createElement('a');
                link.href = article.filePath;
                link.className = 'blog-card-link';

                const title = document.createElement('h2');
                title.className = 'blog-card-title';
                title.textContent = article.title;

                const excerpt = document.createElement('p');
                excerpt.className = 'blog-card-excerpt';
                excerpt.textContent = article.excerpt;

                const meta = document.createElement('div');
                meta.className = 'blog-card-meta';

                const category = document.createElement('span');
                category.className = 'blog-card-category';
                category.textContent = article.category;

                meta.appendChild(category);

                article.tags.forEach(tag => {
                    const tagSpan = document.createElement('span');
                    tagSpan.className = 'blog-card-tag';
                    tagSpan.textContent = tag;
                    meta.appendChild(tagSpan);
                });

                link.appendChild(title);
                link.appendChild(excerpt);
                card.appendChild(link);
                card.appendChild(meta);

                if (article.date) {
                    const dateElement = document.createElement('div');
                    dateElement.className = 'blog-card-date';
                    dateElement.textContent = article.date;
                    card.appendChild(dateElement);
                }

                return card;
            }
        };

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('load', () => {
            Search.init();
            BlogLoader.init();
        });
    </script>
    <script src="js/navigation.js"></script>
    
    <!-- é¡µé¢è¿‡æ¸¡æŒ‡ç¤ºå™¨ -->
    <div id="page-transition-indicator">
        <div class="spinner"></div>
    </div>
</body>
</html>