<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
    <link rel="preload" href="css/style.css" as="style">
    <meta name="description" content="åœ¨çº¿è®¡æ—¶å™¨å·¥å…·">
    <title>å·¥å…· - Mr.Xia</title>
    <link rel="stylesheet" href="css/style.css">
    <!-- é€‰é¡¹å¡æ ·å¼ -->
    <style>
        .tabs {
            display: flex;
            justify-content: center;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-lg);
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: var(--spacing-sm) var(--spacing-md);
            border: none;
            border-radius: var(--radius-md);
            background-color: var(--background-color);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            cursor: pointer;
            font-size: 1em;
            transition: all 0.2s ease;
        }

        .tab-btn:hover {
            background-color: var(--hover-color);
            border-color: var(--primary-color);
        }

        .tab-btn.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .tab-content {
            margin-bottom: var(--spacing-lg);
        }

        .tab-panel {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-panel.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <!-- åŠ¨æ€èƒŒæ™¯ -->
    <div class="bg-img"></div>

    <!-- é¡µçœ‰å¯¼èˆª -->
    <header>
        <nav>
            <div class="logo">Mr.Xia</div>
            <ul class="nav-links" role="list">
                <li><a href="index.html" data-history="true" data-title="é¦–é¡µ">é¦–é¡µ</a></li>
                <li><a href="Works.html" data-history="true" data-title="ä½œå“">ä½œå“</a></li>
                <li><a href="timetable.html" data-history="true" data-title="å·¥å…·" aria-current="page">å·¥å…·</a></li>
                <li><a href="statement.html" data-history="true" data-title="æ–‡ç« ">æ–‡ç« </a></li>
                <li><a href="about.html" data-history="true" data-title="å…³äº">å…³äº</a></li>
            </ul>
        </nav>
    </header>

    <!-- ä¸»å†…å®¹ -->
    <main>
        <section>
            <h1 style="text-align: center;">å·¥å…·é›† ğŸ› ï¸</h1>
            <p style="text-align: center; color: var(--text-secondary); margin-bottom: var(--spacing-xl);">
                å®ç”¨å·¥å…·é›†åˆï¼ŒåŒ…æ‹¬åœ¨çº¿è®¡æ—¶å™¨å’Œéšæœºé€‰æ‹©å™¨
            </p>
        </section>

        <!-- é€‰é¡¹å¡å¯¼èˆª -->
        <div class="tabs">
            <button class="tab-btn active" data-tab="timer" aria-label="åœ¨çº¿è®¡æ—¶å™¨é€‰é¡¹å¡">åœ¨çº¿è®¡æ—¶å™¨ â±ï¸</button>
            <button class="tab-btn" data-tab="random-selector" aria-label="éšæœºé€‰æ‹©å™¨é€‰é¡¹å¡">éšæœºé€‰æ‹©å™¨ ğŸ²</button>
        </div>

        <!-- é€‰é¡¹å¡å†…å®¹ -->
        <div class="tab-content">
            <!-- è®¡æ—¶å™¨é€‰é¡¹å¡ -->
            <div id="timer" class="tab-panel active">
                <!-- è®¡æ—¶å™¨å®¹å™¨ -->
                <div class="card timer-container">
                    <!-- æ—¶é—´è®¾ç½®åŒºåŸŸ -->
                    <div class="timer-setup">
                        <h3 style="margin-bottom: var(--spacing-md); text-align: center;">â±ï¸ è®¾ç½®è®¡æ—¶æ—¶é—´</h3>
                        <div class="time-inputs">
                            <div class="time-input-group">
                                <label for="hours">å°æ—¶</label>
                                <div class="time-input-wrapper">
                                    <button class="time-btn time-decrease" onclick="changeTime('hours', -1)" aria-label="å‡å°‘å°æ—¶">-</button>
                                    <input type="number" id="hours" name="hours" min="0" max="99" value="0" class="time-input" aria-label="å°æ—¶">
                                    <button class="time-btn time-increase" onclick="changeTime('hours', 1)" aria-label="å¢åŠ å°æ—¶">+</button>
                                </div>
                            </div>
                            <span class="time-separator">:</span>
                            <div class="time-input-group">
                                <label for="minutes">åˆ†é’Ÿ</label>
                                <div class="time-input-wrapper">
                                    <button class="time-btn time-decrease" onclick="changeTime('minutes', -1)" aria-label="å‡å°‘åˆ†é’Ÿ">-</button>
                                    <input type="number" id="minutes" name="minutes" min="0" max="59" value="0" class="time-input" aria-label="åˆ†é’Ÿ">
                                    <button class="time-btn time-increase" onclick="changeTime('minutes', 1)" aria-label="å¢åŠ åˆ†é’Ÿ">+</button>
                                </div>
                            </div>
                            <span class="time-separator">:</span>
                            <div class="time-input-group">
                                <label for="seconds">ç§’æ•°</label>
                                <div class="time-input-wrapper">
                                    <button class="time-btn time-decrease" onclick="changeTime('seconds', -1)" aria-label="å‡å°‘ç§’æ•°">-</button>
                                    <input type="number" id="seconds" name="seconds" min="0" max="59" value="0" class="time-input" aria-label="ç§’æ•°">
                                    <button class="time-btn time-increase" onclick="changeTime('seconds', 1)" aria-label="å¢åŠ ç§’æ•°">+</button>
                                </div>
                            </div>
                        </div>
                        <button id="set-time" class="btn btn-outline" style="margin-top: var(--spacing-md);">è®¾ç½®æ—¶é—´</button>
                    </div>

                    <!-- æ—¶é—´æ˜¾ç¤º -->
                    <div id="timer-display">
                        00:00:00
                    </div>

                    <!-- è®¡æ—¶è¿›åº¦æ˜¾ç¤º -->
                    <div class="timer-progress">
                        <div class="progress-bar-container">
                            <div id="progress-bar" class="progress-bar"></div>
                        </div>
                        <div class="progress-info">
                            <span id="progress-text">0%</span>
                        </div>
                    </div>

                    <!-- æ§åˆ¶æŒ‰é’® -->
                    <div class="timer-controls">
                        <button id="start" class="btn" aria-label="å¼€å§‹è®¡æ—¶">
                            â–¶ï¸ å¼€å§‹
                        </button>
                        <button id="pause" class="btn btn-secondary" aria-label="æš‚åœè®¡æ—¶">
                            â¸ï¸ æš‚åœ
                        </button>
                        <button id="reset" class="btn btn-outline" aria-label="é‡ç½®è®¡æ—¶å™¨">
                            ğŸ”„ é‡ç½®
                        </button>
                    </div>

                    <!-- ä½¿ç”¨è¯´æ˜ -->
                    <div class="timer-info">
                        <p class="text-small">
                            ğŸ’¡ æç¤ºï¼šè®¾ç½®è®¡æ—¶æ—¶é—´åï¼Œç‚¹å‡»"å¼€å§‹"æŒ‰é’®å¼€å§‹è®¡æ—¶ï¼Œ"æš‚åœ"æš‚åœè®¡æ—¶ï¼Œ"é‡ç½®"æ¸…é›¶è®¡æ—¶å™¨
                        </p>
                    </div>
                </div>

                <!-- åŠŸèƒ½è¯´æ˜ -->
                <div class="shadowbox">
                    <h3>âœ¨ åŠŸèƒ½ç‰¹ç‚¹</h3>
                    <ul style="list-style: none; padding: 0; margin-top: var(--spacing-md);">
                        <li style="padding: var(--spacing-sm) 0; color: var(--text-secondary);">
                            âœ“ ç²¾ç¡®åˆ°ç§’çš„è®¡æ—¶åŠŸèƒ½
                        </li>
                        <li style="padding: var(--spacing-sm) 0; color: var(--text-secondary);">
                            âœ“ æ”¯æŒæš‚åœå’Œç»§ç»­è®¡æ—¶
                        </li>
                        <li style="padding: var(--spacing-sm) 0; color: var(--text-secondary);">
                            âœ“ ä¸€é”®é‡ç½®è®¡æ—¶å™¨
                        </li>
                        <li style="padding: var(--spacing-sm) 0; color: var(--text-secondary);">
                            âœ“ ç®€æ´ç¾è§‚çš„ç•Œé¢è®¾è®¡
                        </li>
                    </ul>
                </div>
            </div>

            <!-- éšæœºé€‰æ‹©å™¨é€‰é¡¹å¡ -->
            <div id="random-selector" class="tab-panel">
                <div class="random-selector-container">
                    <h2 style="text-align: center; color: var(--primary-color); margin-bottom: var(--spacing-lg);">éšæœºé€‰æ‹©å™¨ By Copilot</h2>
                    <div class="actions" style="display: flex; flex-wrap: wrap; gap: var(--spacing-sm); justify-content: center; margin-bottom: var(--spacing-md);">
                        <input type="text" id="itemInput" placeholder="è¯·è¾“å…¥é€‰é¡¹ï¼Œå›è½¦æˆ–ç‚¹å‡»æ·»åŠ " style="flex: 1 0 110px; min-width: 0; padding: var(--spacing-sm); font-size: 1em; border: 1.5px solid var(--border-color); border-radius: var(--radius-md); outline: none; transition: border 0.2s;" />
                        <button class="btn" onclick="RandomSelector.addItem()">æ·»åŠ </button>
                        <button class="btn" onclick="RandomSelector.deleteAll()">æ¸…ç©º</button>
                    </div>
                    <ul id="items" style="list-style: none; padding-left: 0; margin-bottom: var(--spacing-lg); min-height: 30px; width: 100%; max-height: 200px; overflow-y: auto; border: 1px solid var(--border-color); border-radius: var(--radius-md); padding: var(--spacing-sm);"></ul>
                    <div class="actions" style="display: flex; justify-content: center; margin-bottom: var(--spacing-md);">
                        <button class="btn" onclick="RandomSelector.chooseRandom()">éšæœºæŠ½å–</button>
                    </div>
                    <span id="chosen" style="display: block; text-align: center; color: var(--primary-color); font-size: 1.25em; font-weight: 600; margin: var(--spacing-md) 0; min-height: 25px; letter-spacing: 1px;"></span>
                    <div id="upload" style="text-align: center; margin-top: var(--spacing-md);">
                        <input type="file" id="fileInput" accept=".txt,.md,.docx" multiple aria-label="ä¸Šä¼ æ–‡æ¡£æ–‡ä»¶" style="font-size: 1em; border-radius: var(--radius-md); border: 1px solid var(--border-color); padding: 5px; margin-bottom: var(--spacing-sm); background: var(--background-color);" />
                        <button class="btn" onclick="RandomSelector.handleFiles()" aria-label="ä¸Šä¼ æ–‡æ¡£å¹¶è‡ªåŠ¨å¡«å……">ä¸Šä¼ æ–‡æ¡£å¹¶è‡ªåŠ¨å¡«å……</button>
                        <div class="note" style="font-size: 0.92em; color: var(--text-secondary); margin-top: var(--spacing-xs);">æ”¯æŒTXTã€Markdownã€Wordæ–‡æ¡£</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- è¿”å›é¦–é¡µ -->
        <div style="text-align: center; margin-top: var(--spacing-xl);">
            <a href="index.html" class="btn btn-secondary" onclick="NavigationController.goHome(); return false;">
                â† è¿”å›é¦–é¡µ
            </a>
        </div>

        <!-- é¡µè„š -->
        <div class="footer" style="text-align: right;">
            <p class="footer-text">
                <a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener">æ¸ICPå¤‡2026000319å·</a>
                <br>
                <a href="https://beian.mps.gov.cn/#/query/webSearch?code=50010102001439" rel="noreferrer" target="_blank">
                    <img src="storage/Beian.png" alt="å…¬å®‰å¤‡æ¡ˆ" style="width: 20px; height: 20px; vertical-align: middle; margin-left: 5px;" loading="lazy">
                    æ¸å…¬ç½‘å®‰å¤‡50010102001439å·
                </a>
            </p>
        </div>
    </main>

    <!-- JavaScript -->
    <script src="js/main.js"></script>
    <script src="js/navigation.js"></script>
    <script>
        // é€‰é¡¹å¡åˆ‡æ¢åŠŸèƒ½
        document.addEventListener('DOMContentLoaded', function() {
            // é€‰é¡¹å¡åˆ‡æ¢
            const tabBtns = document.querySelectorAll('.tab-btn');
            const tabPanels = document.querySelectorAll('.tab-panel');

            tabBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const targetTab = btn.getAttribute('data-tab');

                    // ç§»é™¤æ‰€æœ‰é€‰é¡¹å¡çš„æ¿€æ´»çŠ¶æ€
                    tabBtns.forEach(b => b.classList.remove('active'));
                    tabPanels.forEach(p => p.classList.remove('active'));

                    // æ¿€æ´»å½“å‰é€‰é¡¹å¡
                    btn.classList.add('active');
                    const activePanel = document.getElementById(targetTab);
                    activePanel.classList.add('active');
                    
                    // å¦‚æœåˆ‡æ¢åˆ°è®¡æ—¶å™¨é€‰é¡¹å¡ï¼Œç¡®ä¿è®¡æ—¶å™¨çŠ¶æ€æ­£ç¡®
                    if (targetTab === 'timer' && window.MrXiaApp && window.MrXiaApp.Timer) {
                        const timer = window.MrXiaApp.Timer;
                        const timerElement = document.getElementById('timer-display');
                        
                        // ç¡®ä¿è®¡æ—¶å™¨æ˜¾ç¤ºæ­£ç¡®
                        if (timerElement) {
                            const totalSeconds = Math.floor(timer.elapsedTime / 1000);
                            timerElement.textContent = timer.formatTime(totalSeconds);
                        }
                        
                        // ç¡®ä¿æŒ‰é’®çŠ¶æ€æ­£ç¡®
                        const startBtn = document.getElementById('start');
                        const pauseBtn = document.getElementById('pause');
                        if (startBtn && pauseBtn) {
                            startBtn.disabled = timer.isRunning;
                            pauseBtn.disabled = !timer.isRunning;
                        }
                    }
                });
            });
        });

        // æ—¶é—´è°ƒæ•´å‡½æ•°
        function changeTime(type, delta) {
            const input = document.getElementById(type);
            if (!input) return;
            
            const min = parseInt(input.min);
            const max = parseInt(input.max);
            let value = parseInt(input.value) || 0;
            
            // æ›´æ–°å€¼
            value += delta;
            
            // å¤„ç†è¾¹ç•Œæƒ…å†µ
            if (type === 'hours') {
                value = Math.max(min, Math.min(max, value));
            } else {
                // åˆ†é’Ÿå’Œç§’æ•°çš„ç‰¹æ®Šå¤„ç†ï¼Œå…è®¸è·¨è¾¹ç•Œè¿›ä½/å€Ÿä½
                if (value < min) {
                    if (type === 'minutes') {
                        // åˆ†é’Ÿå€Ÿä½åˆ°å°æ—¶
                        const hoursInput = document.getElementById('hours');
                        if (hoursInput) {
                            let hours = parseInt(hoursInput.value) || 0;
                            if (hours > 0) {
                                hours--;
                                hoursInput.value = hours;
                                value = max;
                            } else {
                                value = min;
                            }
                        }
                    } else if (type === 'seconds') {
                        // ç§’æ•°å€Ÿä½åˆ°åˆ†é’Ÿ
                        const minutesInput = document.getElementById('minutes');
                        if (minutesInput) {
                            let minutes = parseInt(minutesInput.value) || 0;
                            if (minutes > 0) {
                                minutes--;
                                minutesInput.value = minutes;
                                value = max;
                            } else {
                                value = min;
                            }
                        }
                    }
                } else if (value > max) {
                    if (type === 'minutes') {
                        // åˆ†é’Ÿè¿›ä½åˆ°å°æ—¶
                        const hoursInput = document.getElementById('hours');
                        if (hoursInput) {
                            let hours = parseInt(hoursInput.value) || 0;
                            if (hours < parseInt(hoursInput.max)) {
                                hours++;
                                hoursInput.value = hours;
                                value = min;
                            } else {
                                value = max;
                            }
                        }
                    } else if (type === 'seconds') {
                        // ç§’æ•°è¿›ä½åˆ°åˆ†é’Ÿ
                        const minutesInput = document.getElementById('minutes');
                        if (minutesInput) {
                            let minutes = parseInt(minutesInput.value) || 0;
                            if (minutes < parseInt(minutesInput.max)) {
                                minutes++;
                                minutesInput.value = minutes;
                                value = min;
                            } else {
                                value = max;
                            }
                        }
                    }
                }
            }
            
            input.value = value;
        }

        // éšæœºé€‰æ‹©å™¨åŠŸèƒ½ - ä½¿ç”¨IIFEå°è£…é¿å…å…¨å±€å˜é‡æ±¡æŸ“
        (function() {
            let items = [];

            function sanitizeInput(input) {
                if (typeof input !== 'string') return '';
                const trimmed = input.trim().substring(0, 200);
                return trimmed
                    .replace(/&/g, '&amp;')
                    .replace(/</g, '&lt;')
                    .replace(/>/g, '&gt;')
                    .replace(/"/g, '&quot;')
                    .replace(/'/g, '&#039;');
            }

            function updateList() {
                const ul = document.getElementById('items');
                ul.innerHTML = '';
                items.forEach((item, idx) => {
                    const li = document.createElement('li');
                    const span = document.createElement('span');
                    span.style.flex = '1 1 0%';
                    span.textContent = item;
                    li.appendChild(span);

                    const btn = document.createElement('button');
                    btn.textContent = 'åˆ é™¤';
                    btn.className = 'remove-btn';
                    btn.onclick = () => { deleteItem(idx); };
                    li.appendChild(btn);

                    ul.appendChild(li);
                });
            }

            function deleteItem(idx) {
                items.splice(idx, 1);
                updateList();
            }

            function fillFromText(text) {
                const lines = text.split(/\r?\n/).map(l => sanitizeInput(l)).filter(l => l);
                lines.forEach(line => {
                    if (!items.includes(line)) items.push(line);
                });
            }

            async function extractDocx(arrayBuffer) {
                if (!window.mammoth) {
                    await loadMammoth();
                }
                window.mammoth.convertToHtml({arrayBuffer})
                    .then(result => {
                        const docText = result.value.replace(/<[^>]+>/g, '\n');
                        fillFromText(docText);
                        updateList();
                    });
            }

            function loadMammoth() {
                return new Promise((resolve) => {
                    const script = document.createElement('script');
                    script.src = "https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.7.0/mammoth.browser.min.js";
                    script.onload = resolve;
                    document.body.appendChild(script);
                });
            }

            // æš´éœ²å¿…è¦çš„å‡½æ•°åˆ°å…¨å±€ä½œç”¨åŸŸï¼ˆä¾›onclickè°ƒç”¨ï¼‰
            window.RandomSelector = {
                addItem: function() {
                    const input = document.getElementById('itemInput');
                    const value = sanitizeInput(input.value);
                    if (value) {
                        items.push(value);
                        input.value = '';
                        updateList();
                    }
                },
                deleteAll: function() {
                    if (items.length === 0) return;
                    if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰é€‰é¡¹å—ï¼Ÿ')) {
                        items = [];
                        updateList();
                        document.getElementById('chosen').textContent = '';
                    }
                },
                chooseRandom: function() {
                    if (items.length === 0) {
                        document.getElementById('chosen').textContent = 'è¯·å…ˆæ·»åŠ é€‰é¡¹';
                        document.getElementById('chosen').style.color = 'var(--error-color, #e05260)';
                        return;
                    }
                    const idx = Math.floor(Math.random() * items.length);
                    document.getElementById('chosen').textContent = 'æŠ½ä¸­ï¼š' + items[idx];
                    document.getElementById('chosen').style.color = 'var(--primary-color)';
                },
                handleFiles: async function() {
                    const input = document.getElementById('fileInput');
                    for (const file of input.files) {
                        if (file.name.endsWith('.txt') || file.name.endsWith('.md')) {
                            const text = await file.text();
                            fillFromText(text);
                        } else if (file.name.endsWith('.docx')) {
                            const arrayBuffer = await file.arrayBuffer();
                            await extractDocx(arrayBuffer);
                        }
                    }
                    updateList();
                    input.value = '';
                }
            };

            // ç›‘å¬å›è½¦äº‹ä»¶
            document.addEventListener('DOMContentLoaded', function() {
                const itemInput = document.getElementById('itemInput');
                if (itemInput) {
                    itemInput.addEventListener('keydown', function(e) {
                        if (e.key === 'Enter') window.RandomSelector.addItem();
                    });
                }
            });
        })();
    </script>
    <!-- éšæœºé€‰æ‹©å™¨æ ·å¼ -->
    <style>
        /* éšæœºé€‰æ‹©å™¨æ ·å¼è°ƒæ•´ */
        .random-selector-container {
            max-width: 600px;
            margin: 0 auto;
        }

        #items li {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: var(--spacing-sm);
            background: rgba(99, 102, 241, 0.05);
            margin-bottom: var(--spacing-xs);
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-md);
            font-size: 1em;
            word-break: break-all;
        }

        .remove-btn {
            color: var(--error-color, #e05260);
            background: none;
            border: none;
            font-size: 0.98em;
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--radius-sm);
            margin-left: var(--spacing-sm);
            cursor: pointer;
            white-space: nowrap;
            flex-shrink: 0;
            transition: all 0.18s ease;
        }

        .remove-btn:hover {
            background: rgba(224, 82, 96, 0.1);
            color: var(--error-color, #b6353e);
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 600px) {
            .actions {
                flex-direction: column;
                gap: var(--spacing-sm);
            }

            #itemInput, .btn, button {
                width: 100%;
                margin: 0;
            }
        }
    </style>
    
    <!-- é¡µé¢è¿‡æ¸¡æŒ‡ç¤ºå™¨ -->
    <div id="page-transition-indicator">
        <div class="spinner"></div>
    </div>
</body>
</html>
